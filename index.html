<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script>
$(document).ready( function() {
    function getWorld() {
        console.log("getworld start")
        $.getJSON("https://api.warframestat.us/pc", function(result){
            var currentTime = Date.now();
            var cetusExpiry = Date.parse(result["cetusCycle"]["expiry"]);
            var minutePassed = 0;
            var timeLeft;
            updateTimeLeft();
            $(".expiry").html(Date(cetusExpiry));
            $(".timeleft").html(msToTime(timeLeft));
            var countDown = setInterval(function() {
                minutePassed += 1000;
                updateTimeLeft();
                $(".timeleft").html(msToTime(timeLeft));
                console.log("counted" + minutePassed)
                if (minutePassed >= 60000) {
                    clearInterval(countDown);
                    getWorld();
                }
            }, 1000);
            
            function updateTimeLeft() {
                timeLeft = cetusExpiry - currentTime - minutePassed;
            }
        })
        //setTimeout(getWorld,60000);
    }
    getWorld();
    
    function msToTime(duration) {
        var milliseconds = parseInt((duration%1000)/100)
            , seconds = parseInt((duration/1000)%60)
            , minutes = parseInt((duration/(1000*60))%60)
            , hours = parseInt((duration/(1000*60*60))%24);

        hours = (hours < 10) ? "0" + hours : hours;
        minutes = (minutes < 10) ? "0" + minutes : minutes;
        seconds = (seconds < 10) ? "0" + seconds : seconds;

        return hours + ":" + minutes + ":" + seconds;
    }
});
</script>
</head>
<body>
    <div class="expiry"></div>
    <div class="timeleft"></div>
</body>
</html>
